# 素材適用システムワークフロー

## 概要
ProductとScene画像から素材を抽出し、指定箇所に適用する画像生成システムのワークフロー

## システム構成
- **素材抽出システム**: gemini-2.5-flash-lite
- **適用範囲検出システム**: gemini-2.5-flash-lite  
- **素材適用システム**: gemini-2.5-flash-image-preview

## ワークフロー

### 1. ユーザー操作フェーズ
#### 1.1 画像アップロード
- ユーザーが2つの画像をアップロード
  - **Product画像**: 抽出したい素材が含まれる画像
  - **Scene画像**: 素材を適用したいシーン画像

#### 1.2 領域指定
- **Product画像での操作**
  - 領域指定ツールを使用して抽出したい素材を囲む
  
- **Scene画像での操作** 
  - 領域指定ツールを使用して素材を適用したい箇所を囲む

#### 1.3 生成実行
- ユーザーが生成ボタンを押下してプロセスを開始

### 2. AI処理フェーズ
#### 2.1 素材抽出処理 (A)
**システム**: gemini-2.5-flash-lite
**入力**: Product画像 + 指定領域
**出力**: 素材の詳細な文章記述
- 質感の詳細な表現
- 色彩の詳細な表現
- その他視覚的特徴の記述

**プロンプト例**:
```
赤い線で囲われた領域内の素材について、以下の観点から詳細に分析し、記述してください：

【質感】
- 表面の粗さ・滑らかさ（マット、光沢、ザラザラ、ツルツルなど）
- 透明度・不透明度
- 反射特性（鏡面反射、拡散反射など）
- 材質感（金属、木材、プラスチック、布、石材など）

【色彩】
- メインカラー（具体的な色名、明度、彩度）
- サブカラー・アクセント色
- グラデーション・色の変化
- 光の当たり方による色の変化

【パターン・テクスチャ】
- 模様、柄、テクスチャの詳細
- 繰り返しパターンの特徴
- 凹凸や立体感

これらの特徴を自然な文章で詳細に記述してください。
```

#### 2.2 適用範囲検出処理 (B) 
**システム**: gemini-2.5-flash-lite
**入力**: Scene画像 + 指定領域
**出力**: 適用範囲の詳細な文章記述
- 位置情報の詳細な表現
- 範囲の詳細な表現
- 空間的関係の記述

**プロンプト例**:
```
赤い線で囲われた領域について、以下の観点から詳細に分析し、記述してください：

【位置情報】
- 画像内での相対的な位置（上部、下部、中央、左右など）
- 他のオブジェクトとの位置関係
- 背景や前景との関係

【範囲・形状】
- 領域の大きさ（画像全体に対する割合）
- 形状の特徴（矩形、円形、不規則など）
- 境界の明確さ・曖昧さ

【空間的特徴】
- 立体感・奥行き
- 光の当たり方・影の状態
- 視点・角度
- 周囲との調和・コントラスト

【現在の状態】
- 既存の素材・テクスチャ
- 色調・明度
- 置き換えが必要な部分の特定

これらの情報を空間認識に基づいて詳細に記述してください。
```

#### 2.3 素材適用処理
**システム**: gemini-2.5-flash-image-preview
**入力**: 
- 素材記述 (A)
- 適用範囲記述 (B)
- Scene画像
**出力**: 生成された画像

**プロンプト例**:
```
以下の条件に基づいて、画像の指定箇所に素材を自然に適用した新しい画像を生成してください：

【素材の特徴】
{素材記述 (A) の内容}

【適用箇所の詳細】
{適用範囲記述 (B) の内容}

【生成要件】
- 元の画像の構図・雰囲気を保持する
- 素材の質感・色彩を忠実に再現する
- 光の当たり方・影を自然に調整する
- 周囲との境界を滑らかに馴染ませる
- パースペクティブ（遠近感）を正しく適用する
- 既存のオブジェクトとの調和を保つ

【品質基準】
- 違和感のない自然な合成
- 高解像度・高品質
- リアリスティックな仕上がり

元の画像の品質と一貫性を保ちながら、指定された素材を適用箇所に自然に融合させてください。
```

### 3. データフロー図
```
[Product画像] → [領域指定] → [素材抽出システム] → (A) 素材記述
                                                        ↓
[Scene画像] → [領域指定] → [適用範囲検出システム] → (B) 適用範囲記述
       ↓                                           ↓
       └─────────────→ [素材適用システム] ←────────┘
                            ↓
                        [生成画像]
```

## 処理の特徴
- **高精度な素材抽出**: gemini-2.5-flash-liteによる詳細な質感・色彩分析
- **正確な位置検出**: 適用箇所の空間的関係を詳細に把握
- **自然な合成**: 文章記述を基にした自然な画像合成

## 期待される成果
- Product画像から抽出した素材がScene画像の指定箇所に自然に適用された新しい画像の生成